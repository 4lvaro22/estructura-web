
{% block title %} Página principal {% endblock %}
{% block body %}

<!-- Iniciar sesión -->
<!-- The core Firebase JS SDK is always required and must be listed first -->

<!-- TODO: Add SDKs for Firebase products that you want to use
https://firebase.google.com/docs/web/setup#available-libraries -->

<!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
<!-- <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-firestore.js"></script> -->

<script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyCtkE8_5vZKjjWsCVFpYsUVWPYPR-QZzTQ",
        authDomain: "parcial-3-c2f59.firebaseapp.com",
        projectId: "parcial-3-c2f59",
        storageBucket: "parcial-3-c2f59.appspot.com",
        messagingSenderId: "18736751354",
        appId: "1:18736751354:web:fa293ad55f135605541f43",
        measurementId: "G-M398PFXFC4"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    
    var provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().languageCode = 'es';
    // To apply the default browser preference instead of explicitly setting it.
    // firebase.auth().useDeviceLanguage();
</script>    

<script>
    // Función para decodificar un token JWT
    function parseJwt(token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));

        return JSON.parse(jsonPayload);
    }

    var user;

    function signIn() {
        firebase.auth().signInWithPopup(provider).then(function(result) {
            // This gives you a Google Access Token. You can use it to access the Google API.
            var token = result.credential.accessToken;
            var idToken = result.credential.idToken;
            // The signed-in user info. More info: https://firebase.google.com/docs/reference/js/firebase.User
            user = result.user;
            console.log('User signed in. ID : ' + user.uid + ', email: ' + user.email);
            console.log('Photo URL: ' + user.photoURL);
            console.log('Nombre' + user.displayName);
            console.log('ID token' + token);
            var decodedToken = parseJwt(idToken);
            console.log('Fecha exp token:', idToken);
            var expirationDate = new Date(decodedToken.exp * 1000);
            console.log('Fecha de expiración del token:', expirationDate);

            document.cookie = "token=" + idToken + "; path=/";
            document.cookie = "expires=" + expirationDate.getTime() + "; path=/";

            location.href = "/signIn";

        }).catch(function(error) {
        // Handle Errors here.
            var errorCode = error.code;
            var errorMessage = error.message;
            // The email of the user's account used.
            var email = error.email;
            // The firebase.auth.AuthCredential type that was used.
            var credential = error.credential;
            console.log('An error happened' + errorMessage);
            location.href = "/signOut";
        });
        
    }
    
    function signOut() {
        firebase.auth().signOut().then(function() {
            console.log('User signed out.');
        }).catch(function(error) {
            console.log('An error happened');
        });
        
        document.getElementById("name").innerHTML = "Inicia sesión!!!";
    }
    
</script>

<table>
    <tr>
        <td><h1>Estructura</h1></td> <td><h2>Hola:<p id="name"></p></h2></td>
    </tr>
</table>

<h3>Google Firebase Auth</h3>
<p><a onclick="signIn();">Sign in</a></p>   
<p><a href="/signOut" onclick="signOut();">Sign out</a></p>

<h3>Crear entidad</h3>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="/crear">Crear entidad</a>
<br/><br/>

<h3>Mostrar entidad</h3>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="/mostrar">Mostrar entidad + Eliminar + Editar</a>
<br/><br/>

<h3>Mapa simple: coordenadas y zoom fijos</h3>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="/simpleMap">simpleMap.html</a>
<br/><br/>

<h3>Mapa con marcador: coordenadas y zoom fijos</h3>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="/mapWithMarker">mapWithmarker.html</a>
<br/><br/>

<h3>Mapa con marcador, a partir de unas coordenadas</h3>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="/showMap">showMap.html</a>
<br/><br/>

<h3>Geocoding: muestra coordenadas</h3>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="/nominatim">nominatim.html</a>
<br/><br/>

<h3>Mapa con marcador, a partir de una direcci&oacute;n (Geocoding)</h3>
&nbsp;&nbsp;&nbsp;&nbsp;<a href="/geocoding">geocoding.html</a>
<br/><br/>S
        
{% endblock %}
